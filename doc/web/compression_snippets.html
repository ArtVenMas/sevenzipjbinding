<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta name="verify-v1" content="mCmiZMVFK9OR5rFvabIsFhsHCfxvP4vfF5pvGSCjHOg=" />
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1" />
<title>Welcome to 7-Zip-JBinding project</title>
<link href="styles.css" rel="stylesheet" type="text/css" />
<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://sourceforge.net/apps/piwik/sevenzipjbind/" : "http://sourceforge.net/apps/piwik/sevenzipjbind/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 1;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p><img src="http://sourceforge.net/apps/piwik/sevenzipjbind/piwik.php?idsite=1" alt="piwik"/></p></noscript></object>
<!-- End Piwik Tag -->
</head>
<body>
<center>
<table><tr><td width="1000" align="left">
<a href="http://sourceforge.net/donate/index.php?group_id=210915"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /></a>
<a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=210915&amp;type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a>
<!--&nbsp;<font size="+1">7-Zip-JBinding</font><br/> -->

<table border="0" width="100%">
<tr><td valign="bottom"><img src="logo-small.png" alt="Logo"></td><td align="center"><img src="logo-big.png" alt="Logo Big" /></td></tr>
<tr><td height="50"></td></tr>
<tr><td width="240" valign="top" class="menu">
<table class="menu" border="0">
<tr><td><a href="index.html">Home</a></td></tr>
<tr><td><a href="https://sourceforge.net/projects/sevenzipjbind/">SF-Home</a></td></tr>
<tr><td><a href="first_steps.html">Documentation</a><br/>
<table class="submenu" border="0">
	<tr><td><a href="first_steps.html" >First steps</a></td></tr>
	<tr><td>
	   Code snippets
	   <ul class="CodeSnippets submenu">
	       <li><a href="extraction_snippets.html" class="submenu">Extraction</a></li>
	       <li><a href="compression_snippets.html" class="submenu">Compression/Update</a></li>
	   </ul>
	</td></tr>
	<tr><td><a href="javadoc/index.html" class="submenu">JavaDoc</a></td></tr>
</table></td></tr>
<tr><td><a href="http://sourceforge.net/projects/sevenzipjbind/files/7-Zip-JBinding/4.65-1.06rc-extr-only/" class="menu">Download</a></td></tr>
<tr><td><a href="http://my.cdash.org/index.php?project=7-Zip-JBinding" class="menu">Test Dashboard</a></td></tr>
<tr><td><a href="https://sourceforge.net/projects/sevenzipjbind/forums" class="menu">Forum</a></td></tr>
<tr><td><a href="http://sourceforge.net/tracker/?group_id=210915" class="menu">Tracker</a></td></tr>
<tr><td><a href="http://sourceforge.net/donate/index.php?group_id=210915" class="menu">Donate Money to<br/>7-Zip-JBinding</a></td></tr>
</table>
<br/><br/>
<iframe marginheight="0" marginwidth="0" frameborder="0" height="1000" scrolling="no" width="220" src="voting.php">Your browser does not support iframes</iframe>
</td><td align="left">
<h1>Archive compression and modification code snippets</h1>
<h2>Index</h2>
<ul>
    <li><a href="#creating">Creating new archives</a></li>
    <ul>
        <li><a href="#archive-test-structure">Archive test structure</a></li>
        <li><a href="#create-specific-api">Creating archives with the generic API</a></li>
    	<ul>
    		<li><a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-7z">Creating 7-Zip archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-tar">Creating Tar archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-gzip">Creating GZip archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-bzip2">Creating BZip2 archive using archive format specific API</a></li>
    	</ul>
        <li><a href="#create-generic">Creating archives with the archive format specific API</a></li>
    </ul>
    <li><a href="#modification">Modification existing archives</a></li>
    <ul>
    </ul>
</ul>
<h1><a name="creating">Creating new archives</h1>
<p>
The are two slightly different APIs for creating new archives:
<ul>
<li>archive format specificAPI</li>
<li>archive format independent API</li>
</ul>
The first API is designed to work with one particilar archive format, like Zip. The Second API
allows archive format independent programming.
</p>
<h2><a name="archive-test-structure">Archive test structure</h2>
<p>
Some archive formats like GZip only support compression of a single file, while other archive formats
allow multiple files and folders to be compressed.
In order to demonstrate how those archives can be created, some test file and folder structure is required.
The following snippets use a static structure defined by the CompressArchiveStructure class:
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressArchiveStructure {
    <span class="java-keyword">public</span> <span class="java-keyword">static</span> Item[] initArchiveStructure() {

        <span class="java-comment">//     &#60;root&#62;</span>
        <span class="java-comment">//     |</span>
        <span class="java-comment">//     +- info.txt</span>
        <span class="java-comment">//     +- random-100-bytes.dump</span>
        <span class="java-comment">//     +- dir1</span>
        <span class="java-comment">//     |  +- file-in-a-directory1.txt</span>
        <span class="java-comment">//     +- dir2</span>
        <span class="java-comment">//        +- file-in-a-directory2.txt</span>

        Item[] items = <span class="java-keyword">new</span> Item[5];

        items[0] = <span class="java-keyword">new</span> Item(<span class="java-string">"info.txt"</span>, <span class="java-string">"This is the info"</span>);

        <span class="java-keyword">byte</span>[] content = <span class="java-keyword">new</span> <span class="java-keyword">byte</span>[100];
        <span class="java-keyword">new</span> Random().nextBytes(content);
        items[1] = <span class="java-keyword">new</span> Item(<span class="java-string">"random-100-bytes.dump"</span>, content);

        <span class="java-comment">// dir1 doesn't have separate archive item</span>
        items[2] = <span class="java-keyword">new</span> Item(<span class="java-string">"dir1"</span> + File.separator + <span class="java-string">"file1.txt"</span>, 
                <span class="java-string">"This file located in a directory 'dir'"</span>);

        <span class="java-comment">// dir2 does have separate archive item</span>
        items[3] = <span class="java-keyword">new</span> Item(<span class="java-string">"dir2"</span> + File.separator, (<span class="java-keyword">byte</span>[]) <span class="java-keyword">null</span>);
        items[4] = <span class="java-keyword">new</span> Item(<span class="java-string">"dir2"</span> + File.separator + <span class="java-string">"file2.txt"</span>, 
                <span class="java-string">"This file located in a directory 'dir'"</span>);
        <span class="java-keyword">return</span> items;
    }

    <span class="java-keyword">static</span> <span class="java-keyword">class</span> Item {
        <span class="java-keyword">private</span> String <span class="java-field">path</span>;
        <span class="java-keyword">private</span> <span class="java-keyword">byte</span>[] <span class="java-field">content</span>;

        Item(String path, String content) {
            <span class="java-keyword">this</span>(path, content.getBytes());
        }

        Item(String path, <span class="java-keyword">byte</span>[] content) {
            <span class="java-keyword">this</span>.<span class="java-field">path</span>= path;
            <span class="java-keyword">this</span>.<span class="java-field">content</span>= content;
        }

        String getPath() {
            <span class="java-keyword">return</span> <span class="java-field">path</span>;
        }

        <span class="java-keyword">byte</span>[] getContent() {
            <span class="java-keyword">return</span> <span class="java-field">content</span>;
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressArchiveStructure.java">download java code</a></div>
<h2><a name="create-specific-api">Creating archives with the archive format specific API</h2>
<p>
The archive format specific API provides easy access to the archive configuration
methods (e.g. for setting the compression level).
Also it uses archive format spefic item description interfaces (like IOutItemZip for Zip).
Different archive formats support different archive item properties. 
Those interfaces provide access to the propreties supported by the corresponding
archive format, whether the unsupported properties remain hidden.
</p>
<p>
Lets see how different archives can be created using archive format specific API
</p>
<h3><a name="create-specific-api-zip">Creating Zip archive using archive format specific API</h3>
<p>
Creating Zip archive using archive format specific API was already presented in the "first steps".
The key parts of the code are:
</p>
<ul>
    <li>
        Implementation of the <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&lt;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemCallbackZip.html">IOutItemCallbackZip</a>&gt; interface specifying the structure of
        the new archive. Also the progress of the compression/update operation get reported here.
    </li>
    <li>
        Creating an instance of the <a href="javadoc/net/sf/sevenzipjbinding/IOutArchive.html">IOutArchive</a> interface and calling createArchive() method.
    </li>
</ul>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveZip.html">IOutCreateArchiveZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.IOutItemZip;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/PropID.html">PropID</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.OutItemFactory;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGenericZip {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;IOutItemZip&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> IOutItemZip getItemInformation(<span class="java-keyword">int</span> index,
                OutItemFactory&#60;IOutItemZip&#62; outItemFactory) {
            <span class="java-keyword">int</span> attr = <a href="javadoc/net/sf/sevenzipjbinding/PropID.AttributesBitMask.html">PropID.AttributesBitMask</a>.<span class="java-staticfield">FILE_ATTRIBUTE_UNIX_EXTENSION</span>;

            IOutItemZip item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
                attr |= <a href="javadoc/net/sf/sevenzipjbinding/PropID.AttributesBitMask.html">PropID.AttributesBitMask</a>.<span class="java-staticfield">FILE_ATTRIBUTE_DIRECTORY</span>;
                attr |= 0x81ED &#60;&#60; 16; <span class="java-comment">// permissions: drwxr-xr-x</span>
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
                attr |= 0x81a4 &#60;&#60; 16; <span class="java-comment">// permissions: -rw-r--r--</span>
            }
            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            item.setPropertyAttributes(attr);

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> != 1) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java Compress &#60;archive&#62;"</span>);
            <span class="java-keyword">return</span>;
        }

        <span class="java-keyword">new</span> CompressNonGenericZip().compress(args[0]);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        items = CompressArchiveStructure.initArchiveStructure();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveZip.html">IOutCreateArchiveZip</a> outArchive = <span class="java-keyword">null</span>;
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveZip();

            <span class="java-comment">// Configure archive</span>
            outArchive.setLevel(5);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    <span class="java-field">items</span>.<span class="java-field">length</span>, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"7z-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGenericZip.java">download java code</a></div>
<p>
If you run this program with (on Linux)
</p>
<div class="fragment"><pre class="fragment">
$ java -cp &lsaquo;path-to-lib&rsaquo;\sevenzip-jbinding.jar; 
           &lsaquo;path-to-lib&rsaquo;\sevenzipjbinding-Windows-x86.jar;.
       CompressNonGenericZip compressed.zip
</pre></div>
<p>
you will get the output
</p>
<div class="fragment"><pre class="fragment">
Compression operation succeeded
</pre></div>
<p>
The archive file compressed.zip should be created. It contains files and folders speficied in the <a href="#archive-test-structure">CompressArchiveStructure</a> class.
</p>
<div class="fragment"><pre class="fragment">
$ 7z l compressed.zip
Listing archive: compressed.zip
--
Path = compressed.zip
Type = zip
Physical Size = 718
   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2015-09-09 08:56:42 .....           16           16  info.txt
2015-09-09 08:56:42 .....          100          100  random-100-bytes.dump
2015-09-09 08:56:42 .....           38           38  dir1/file1.txt
2015-09-09 08:56:42 D....            0            0  dir2
2015-09-09 08:56:42 .....           38           38  dir2/file2.txt
------------------- ----- ------------ ------------  ------------------------
                                   192          192  4 files, 1 folders
</pre></div>
<h3><a name="create-specific-api-7z">Creating 7-Zip archive using archive format specific API</h3>
<p>
Creating 7z archive is a little bit easer that creating Zip archives. The main difference is the implementation
of the MyCreateCallback.getItemInformation() method. 7z doesn't need relative complex calculation of the attribute
property providing a nice default behavour.
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchive7z.html">IOutCreateArchive7z</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.IOutItem7z;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.OutItemFactory;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGeneric7z {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;IOutItem7z&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> IOutItem7z getItemInformation(<span class="java-keyword">int</span> index,
                OutItemFactory&#60;IOutItem7z&#62; outItemFactory) {
            IOutItem7z item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
            }

            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> != 1) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java Compress &#60;archive&#62;"</span>);
            <span class="java-keyword">return</span>;
        }

        <span class="java-keyword">new</span> CompressNonGeneric7z().compress(args[0]);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        items = CompressArchiveStructure.initArchiveStructure();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchive7z.html">IOutCreateArchive7z</a> outArchive = <span class="java-keyword">null</span>;
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchive7z();

            <span class="java-comment">// Configure archive</span>
            outArchive.setLevel(5);
            outArchive.setSolid(<span class="java-keyword">true</span>);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    <span class="java-field">items</span>.<span class="java-field">length</span>, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"7z-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGeneric7z.java">download java code</a></div>
<p>
For instructions on how to running the snippet and check the results see <a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a>.
</p>
<h3><a name="create-specific-api-tar">Creating Tar archive using archive format specific API</h3>
<p>
Creating tar archives is pretty much the same, as creating 7z archives, since the default values for most properties
are good enough in most cases. Note, that the tar archive format do have attribute property.
But due to the Unix-nature of the tar, it was renamed to PosixAttributes. Also the meaning of the bits is different.
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveTar.html">IOutCreateArchiveTar</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.IOutItemTar;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.OutItemFactory;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGenericTar {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;IOutItemTar&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> IOutItemTar getItemInformation(<span class="java-keyword">int</span> index,
                OutItemFactory&#60;IOutItemTar&#62; outItemFactory) {
            IOutItemTar item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
            }

            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> != 1) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java Compress &#60;archive&#62;"</span>);
            <span class="java-keyword">return</span>;
        }

        <span class="java-keyword">new</span> CompressNonGenericTar().compress(args[0]);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        items = CompressArchiveStructure.initArchiveStructure();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveTar.html">IOutCreateArchiveTar</a> outArchive = <span class="java-keyword">null</span>;
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveTar();

            <span class="java-comment">// No configuration methods for Tar</span>

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    <span class="java-field">items</span>.<span class="java-field">length</span>, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Tar-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGenericTar.java">download java code</a></div>
<p>
For instructions on how to running the snippet and check the results see <a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a>.
</p>
<h3><a name="create-specific-api-gzip">Creating GZip archive using archive format specific API</h3>
<p>
GZip format is a stream archive format meaning, that it can compress only a single file. This simplifies
the programming quite a bit. In the following snippet a single message passed by the second command line
parameter get compressed.  
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveGZip.html">IOutCreateArchiveGZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.IOutItemGZip;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.OutItemFactory;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGenericGZip {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;IOutItemGZip&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> IOutItemGZip getItemInformation(<span class="java-keyword">int</span> index,
                OutItemFactory&#60;IOutItemGZip&#62; outItemFactory) {
            IOutItemGZip item = outItemFactory.createOutItem();

            item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">content</span>.<span class="java-field">length</span>);

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">content</span>, <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">byte</span>[] content;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> != 2) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java Compress &#60;archive&#62; &#60;msg&#62;"</span>);
            <span class="java-keyword">return</span>;
        }

        <span class="java-keyword">new</span> CompressNonGenericGZip().compress(args[0], args[1]);
    }

    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename, String msg) {
        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveGZip.html">IOutCreateArchiveGZip</a> outArchive = <span class="java-keyword">null</span>;
        content = msg.getBytes();
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveGZip();

            <span class="java-comment">// Configure archive</span>
            outArchive.setLevel(5);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    1, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"GZip-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGenericGZip.java">download java code</a></div>
<h3><a name="create-specific-api-bzip2">Creating BZip2 archive using archive format specific API</h3>
<h2><a name="create-generic">Creating archives with the generic API</h2>
<br/>
<h1><a name="modification">Modification existing archives</h1>
</td></tr>
</table></td></tr>
</table>
</center>
</body>
</html>
