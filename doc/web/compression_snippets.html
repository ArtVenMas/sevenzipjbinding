<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta name="verify-v1" content="mCmiZMVFK9OR5rFvabIsFhsHCfxvP4vfF5pvGSCjHOg=" />
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1" />
<title>Welcome to 7-Zip-JBinding project</title>
<link href="styles.css" rel="stylesheet" type="text/css" />

<!-- BEGIN Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67460313-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- END Google Analytics -->

</head>
<body>
<center>
<table><tr><td width="1000" align="left">
<a href="http://sourceforge.net/donate/index.php?group_id=210915"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /></a>
<a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=210915&amp;type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a>
<!--&nbsp;<font size="+1">7-Zip-JBinding</font><br/> -->

<table border="0" width="100%">
<tr><td valign="bottom"><img src="logo-small.png" alt="Logo"></td><td align="center"><img src="logo-big.png" alt="Logo Big" /></td></tr>
<tr><td height="50"></td></tr>
<tr><td width="240" valign="top" class="menu">
<table class="menu" border="0">
<tr><td><a href="index.html">Home</a></td></tr>
<tr><td><a href="https://sourceforge.net/projects/sevenzipjbind/">SF-Home</a></td></tr>
<tr><td><a href="first_steps.html">Documentation</a><br/>
<table class="submenu" border="0">
	<tr><td><a href="first_steps.html" >First steps</a></td></tr>
	<tr><td>
	   Code snippets
	   <ul class="CodeSnippets submenu">
	       <li><a href="extraction_snippets.html" class="submenu">Extraction</a></li>
	       <li><a href="compression_snippets.html" class="submenu">Compression/Update</a></li>
	   </ul>
	</td></tr>
	<tr><td><a href="javadoc/index.html" class="submenu">JavaDoc</a></td></tr>
</table></td></tr>
<tr><td><a href="http://sourceforge.net/projects/sevenzipjbind/files/7-Zip-JBinding/4.65-1.06rc-extr-only/" class="menu">Download</a></td></tr>
<tr><td><a href="http://my.cdash.org/index.php?project=7-Zip-JBinding" class="menu">Test Dashboard</a></td></tr>
<tr><td><a href="https://sourceforge.net/projects/sevenzipjbind/forums" class="menu">Forum</a></td></tr>
<tr><td><a href="http://sourceforge.net/tracker/?group_id=210915" class="menu">Tracker</a></td></tr>
<tr><td><a href="http://sourceforge.net/donate/index.php?group_id=210915" class="menu">Donate Money to<br/>7-Zip-JBinding</a></td></tr>
</table>
<br/><br/>
<!--
<iframe marginheight="0" marginwidth="0" frameborder="0" height="1000" scrolling="no" width="220" src="voting.php">Your browser does not support iframes</iframe>
-->
</td><td align="left" class="content">
<h1>Archive compression and modification code snippets</h1>
<h2>Index</h2>
<ul>
    <li><a href="#creating">Creating new archives</a></li>
    <ul>
        <li><a href="#archive-test-structure">Archive test structure</a></li>
        <li><a href="#create-specific-api">Creating archives with the generic API</a></li>
    	<ul>
    		<li><a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-7z">Creating 7-Zip archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-tar">Creating Tar archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-gzip">Creating GZip archive using archive format specific API</a></li>
    		<li><a href="#create-specific-api-bzip2">Creating BZip2 archive using archive format specific API</a></li>
    	</ul>
        <li><a href="#create-generic">Creating archives with the archive format specific API</a></li>
    </ul>
    <li><a href="#update">Modifying existing archives</a></li>
    <ul>
        <li><a href="#update-alter-items">Altering existing archive items</a></li>
        <li><a href="#update-add-remove-items">Adding and removing archive items</a></li>
    </ul>
    <li><a href="#trace">Troubleshoot problems using tracing</a></li>
</ul>
<h1><a name="creating">Creating new archives</h1>
<p>
The are two slightly different APIs for creating new archives:
<ul>
<li>archive format specific API</li>
<li>archive format independent API</li>
</ul>
The first API is designed to work with one particular archive format, like Zip. The Second API
allows archive format independent programming.
</p>
<h2><a name="archive-test-structure">Archive test structure</h2>
<p>
Some archive formats like GZip only support compression of a single file, while other archive formats
allow multiple files and folders to be compressed.
In order to demonstrate how those archives can be created, some test file and folder structure is required.
The following snippets use a static structure defined by the CompressArchiveStructure class:
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressArchiveStructure {
    <span class="java-keyword">public</span> <span class="java-keyword">static</span> Item[] create() {

        <span class="java-comment">//     &#60;root&#62;</span>
        <span class="java-comment">//     |</span>
        <span class="java-comment">//     +- info.txt</span>
        <span class="java-comment">//     +- random-100-bytes.dump</span>
        <span class="java-comment">//     +- dir1</span>
        <span class="java-comment">//     |  +- file-in-a-directory1.txt</span>
        <span class="java-comment">//     +- dir2</span>
        <span class="java-comment">//        +- file-in-a-directory2.txt</span>

        Item[] items = <span class="java-keyword">new</span> Item[5];

        items[0] = <span class="java-keyword">new</span> Item(<span class="java-string">"info.txt"</span>, <span class="java-string">"This is the info"</span>);

        <span class="java-keyword">byte</span>[] content = <span class="java-keyword">new</span> <span class="java-keyword">byte</span>[100];
        <span class="java-keyword">new</span> Random().nextBytes(content);
        items[1] = <span class="java-keyword">new</span> Item(<span class="java-string">"random-100-bytes.dump"</span>, content);

        <span class="java-comment">// dir1 doesn't have separate archive item</span>
        items[2] = <span class="java-keyword">new</span> Item(<span class="java-string">"dir1"</span> + File.separator + <span class="java-string">"file1.txt"</span>, 
                <span class="java-string">"This file located in a directory 'dir'"</span>);

        <span class="java-comment">// dir2 does have separate archive item</span>
        items[3] = <span class="java-keyword">new</span> Item(<span class="java-string">"dir2"</span> + File.separator, (<span class="java-keyword">byte</span>[]) <span class="java-keyword">null</span>);
        items[4] = <span class="java-keyword">new</span> Item(<span class="java-string">"dir2"</span> + File.separator + <span class="java-string">"file2.txt"</span>, 
                <span class="java-string">"This file located in a directory 'dir'"</span>);
        <span class="java-keyword">return</span> items;
    }

    <span class="java-keyword">static</span> <span class="java-keyword">class</span> Item {
        <span class="java-keyword">private</span> String <span class="java-field">path</span>;
        <span class="java-keyword">private</span> <span class="java-keyword">byte</span>[] <span class="java-field">content</span>;

        Item(String path, String content) {
            <span class="java-keyword">this</span>(path, content.getBytes());
        }

        Item(String path, <span class="java-keyword">byte</span>[] content) {
            <span class="java-keyword">this</span>.<span class="java-field">path</span>= path;
            <span class="java-keyword">this</span>.<span class="java-field">content</span>= content;
        }

        String getPath() {
            <span class="java-keyword">return</span> <span class="java-field">path</span>;
        }

        <span class="java-keyword">byte</span>[] getContent() {
            <span class="java-keyword">return</span> <span class="java-field">content</span>;
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressArchiveStructure.java">download java code</a></div>
<h2><a name="create-specific-api">Creating archives with the archive format specific API</h2>
<p>
The archive format specific API provides easy access to the archive configuration
methods (e.g. for setting the compression level).
Also it uses archive format specific item description interfaces (like <a href="javadoc/net/sf/sevenzipjbinding/IOutItemZip.html">IOutItemZip</a> for Zip).
Different archive formats support different archive item properties. 
Those interfaces provide access to the properties supported by the corresponding
archive format, whether the unsupported properties remain hidden.
</p>
<p>
Lets see how different archives can be created using archive format specific API
</p>
<h3><a name="create-specific-api-zip">Creating Zip archive using archive format specific API</h3>
<p>
Creating Zip archive using archive format specific API was already presented in the "first steps".
The key parts of the code are:
</p>
<ul>
    <li>
        Implementation of the <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&lt;IOutItemCallbackZip&gt; interface specifying the structure of
        the new archive. Also the progress of the compression/update operation get reported here.
    </li>
    <li>
        Creating an instance of the <a href="javadoc/net/sf/sevenzipjbinding/IOutArchive.html">IOutArchive</a> interface and calling createArchive() method.
    </li>
</ul>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveZip.html">IOutCreateArchiveZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemZip.html">IOutItemZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/PropID.html">PropID</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGenericZip {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemZip.html">IOutItemZip</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemZip.html">IOutItemZip</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemZip.html">IOutItemZip</a>&#62; outItemFactory) {
            <span class="java-keyword">int</span> attr = <a href="javadoc/net/sf/sevenzipjbinding/PropID.AttributesBitMask.html">PropID.AttributesBitMask</a>.<span class="java-staticfield">FILE_ATTRIBUTE_UNIX_EXTENSION</span>;

            <a href="javadoc/net/sf/sevenzipjbinding/IOutItemZip.html">IOutItemZip</a> item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
                attr |= <a href="javadoc/net/sf/sevenzipjbinding/PropID.AttributesBitMask.html">PropID.AttributesBitMask</a>.<span class="java-staticfield">FILE_ATTRIBUTE_DIRECTORY</span>;
                attr |= 0x81ED &#60;&#60; 16; <span class="java-comment">// permissions: drwxr-xr-x</span>
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
                attr |= 0x81a4 &#60;&#60; 16; <span class="java-comment">// permissions: -rw-r--r--</span>
            }
            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            item.setPropertyAttributes(attr);

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 1) {
            <span class="java-keyword">new</span> CompressNonGenericZip().compress(args[0]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java CompressNonGenericZip &#60;archive&#62;"</span>);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        items = CompressArchiveStructure.create();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveZip.html">IOutCreateArchiveZip</a> outArchive = <span class="java-keyword">null</span>;
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveZip();

            <span class="java-comment">// Configure archive</span>
            outArchive.setLevel(5);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    <span class="java-field">items</span>.<span class="java-field">length</span>, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"7z-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGenericZip.java">download java code</a></div>
<p>
If you run this program with (on Linux)
</p>
<div class="fragment"><pre class="fragment">
$ java -cp &lsaquo;path-to-lib&rsaquo;\sevenzipjbinding.jar;              \  
           &lsaquo;path-to-lib&rsaquo;\sevenzipjbinding-Windows-x86.jar;. \ 
       CompressNonGenericZip compressed.zip
</pre></div>
<p>
you will get the output
</p>
<div class="fragment"><pre class="fragment">
Compression operation succeeded
</pre></div>
<p>
The archive file compressed.zip should be created. It contains files and folders specified in the <a href="#archive-test-structure">CompressArchiveStructure</a> class.
</p>
<div class="fragment"><pre class="fragment">
$ 7z l compressed.zip
Listing archive: compressed.zip
--
Path = compressed.zip
Type = zip
Physical Size = 718
   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2015-09-09 08:56:42 .....           16           16  info.txt
2015-09-09 08:56:42 .....          100          100  random-100-bytes.dump
2015-09-09 08:56:42 .....           38           38  dir1/file1.txt
2015-09-09 08:56:42 D....            0            0  dir2
2015-09-09 08:56:42 .....           38           38  dir2/file2.txt
------------------- ----- ------------ ------------  ------------------------
                                   192          192  4 files, 1 folders
</pre></div>
<h3><a name="create-specific-api-7z">Creating 7-Zip archive using archive format specific API</h3>
<p>
Creating 7z archive is a little bit easer that creating Zip archives. The main difference is the implementation
of the MyCreateCallback.getItemInformation() method. 7z doesn't need relative complex calculation of the attribute
property providing a nice default behavior.
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchive7z.html">IOutCreateArchive7z</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItem7z.html">IOutItem7z</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGeneric7z {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItem7z.html">IOutItem7z</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItem7z.html">IOutItem7z</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItem7z.html">IOutItem7z</a>&#62; outItemFactory) {
            <a href="javadoc/net/sf/sevenzipjbinding/IOutItem7z.html">IOutItem7z</a> item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
            }

            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 1) {
            <span class="java-keyword">new</span> CompressNonGeneric7z().compress(args[0]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java CompressNonGeneric7z &#60;archive&#62;"</span>);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        items = CompressArchiveStructure.create();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchive7z.html">IOutCreateArchive7z</a> outArchive = <span class="java-keyword">null</span>;
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchive7z();

            <span class="java-comment">// Configure archive</span>
            outArchive.setLevel(5);
            outArchive.setSolid(<span class="java-keyword">true</span>);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    <span class="java-field">items</span>.<span class="java-field">length</span>, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"7z-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGeneric7z.java">download java code</a></div>
<p>
For instructions on how to running the snippet and check the results see
<a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a>.
</p>
<h3><a name="create-specific-api-tar">Creating Tar archive using archive format specific API</h3>
<p>
Creating tar archives is pretty much the same, as creating 7z archives, since the default values for most properties
are good enough in most cases. Note, that the tar archive format do have attribute property.
But due to the Unix-nature of the tar, it was renamed to PosixAttributes. Also the meaning of the bits is different.
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveTar.html">IOutCreateArchiveTar</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGenericTar {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a>&#62; outItemFactory) {
            <a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a> item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
            }

            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 1) {
            <span class="java-keyword">new</span> CompressNonGenericTar().compress(args[0]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java CompressNonGenericTar &#60;archive&#62;"</span>);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        items = CompressArchiveStructure.create();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveTar.html">IOutCreateArchiveTar</a> outArchive = <span class="java-keyword">null</span>;
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveTar();

            <span class="java-comment">// No configuration methods for Tar</span>

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    <span class="java-field">items</span>.<span class="java-field">length</span>, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Tar-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGenericTar.java">download java code</a></div>
<p>
For instructions on how to running the snippet and check the results see <a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a>.
</p>
<h3><a name="create-specific-api-gzip">Creating GZip archive using archive format specific API</h3>
<p>
GZip format is a stream archive format meaning, that it can only compress a single file. This simplifies
the programming quite a bit. In the following snippet a single message passed through the second command line
parameter get compressed. Note, that like non-stream archive formats GZip also supports optional Path and
LastModificationTime properties for the single archive item.
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveGZip.html">IOutCreateArchiveGZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemGZip.html">IOutItemGZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGenericGZip {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemGZip.html">IOutItemGZip</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemGZip.html">IOutItemGZip</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemGZip.html">IOutItemGZip</a>&#62; outItemFactory) {
            <a href="javadoc/net/sf/sevenzipjbinding/IOutItemGZip.html">IOutItemGZip</a> item = outItemFactory.createOutItem();

            item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">content</span>.<span class="java-field">length</span>);

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">content</span>, <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">byte</span>[] content;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 1) {
            <span class="java-keyword">new</span> CompressNonGenericGZip().compress(args[0]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java CompressNonGenericGZip &#60;archive&#62;"</span>);
    }

    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveGZip.html">IOutCreateArchiveGZip</a> outArchive = <span class="java-keyword">null</span>;
        content = CompressArchiveStructure.create()[0].getContent();
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveGZip();

            <span class="java-comment">// Configure archive</span>
            outArchive.setLevel(5);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    1, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"GZip-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGenericGZip.java">download java code</a></div>
<p>
For instructions on how to running the snippet and check the results see <a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a>.
</p>
<h3><a name="create-specific-api-bzip2">Creating BZip2 archive using archive format specific API</h3>
<p>
BZip2 is like GZip a stream archive format. It compresses single archive item supporting no additional
archive item properties at all.
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveBZip2.html">IOutCreateArchiveBZip2</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemBZip2.html">IOutItemBZip2</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressNonGenericBZip2 {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemBZip2.html">IOutItemBZip2</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemBZip2.html">IOutItemBZip2</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemBZip2.html">IOutItemBZip2</a>&#62; outItemFactory) {
            <a href="javadoc/net/sf/sevenzipjbinding/IOutItemBZip2.html">IOutItemBZip2</a> item = outItemFactory.createOutItem();

            item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">content</span>.<span class="java-field">length</span>);

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">content</span>, <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">byte</span>[] content;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 1) {
            <span class="java-keyword">new</span> CompressNonGenericBZip2().compress(args[0]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java CompressNonGenericBZip2 &#60;archive&#62;"</span>);
    }

    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveBZip2.html">IOutCreateArchiveBZip2</a> outArchive = <span class="java-keyword">null</span>;
        content = CompressArchiveStructure.create()[0].getContent();
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveBZip2();

            <span class="java-comment">// Configure archive</span>
            outArchive.setLevel(5);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    1, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"BZip2-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressNonGenericBZip2.java">download java code</a></div>
<p>
For instructions on how to running the snippet and check the results see <a href="#create-specific-api-zip">Creating Zip archive using archive format specific API</a>.
</p>
<h2><a name="create-generic">Creating archives with the generic API</h2>
<p>
The one of the great features of the 7-Zip (and though of the 7-Zip-JBinding) is the ability to write archive format
independent code supporting most or even all of the archive formats, supported by 7-Zip. The following code snippet
accepts the required archive format as the first parameter compressing the test data in the specified archive format. 
</p>
<p>
The key steps to write a generic compression code are
<ul>
    <li>Use <a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a> interface instead of the one of the archive specific interfaces, like <a href="javadoc/net/sf/sevenzipjbinding/IOutItem7z.html">IOutItem7z</a></li>
    <li>Create out-archive object using generic create method <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchive(<a href="javadoc/net/sf/sevenzipjbinding/ArchiveFormat.html">ArchiveFormat</a>)</li>
</ul>
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ArchiveFormat.html">ArchiveFormat</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchive.html">IOutCreateArchive</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutFeatureSetLevel.html">IOutFeatureSetLevel</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutFeatureSetMultithreading.html">IOutFeatureSetMultithreading</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressGeneric {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; outItemFactory) {
            <a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a> item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
            }

            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> != 3) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java CompressGeneric "</span> 
                    + <span class="java-string">"&#60;archive-format&#62; &#60;archive&#62; &#60;count-of-files&#62;"</span>);
            <span class="java-keyword">for</span> (<a href="javadoc/net/sf/sevenzipjbinding/ArchiveFormat.html">ArchiveFormat</a> af : <a href="javadoc/net/sf/sevenzipjbinding/ArchiveFormat.html">ArchiveFormat</a>.values()) {
                <span class="java-keyword">if</span> (af.isOutArchiveSupported()) {
                    System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Supported formats: "</span> + af.name());
                }
            }
            <span class="java-keyword">return</span>;
        }

        <span class="java-keyword">int</span> itemsCount = Integer.<span class="java-staticmethod">valueOf</span>(args[2]);
        <span class="java-keyword">new</span> CompressGeneric().compress(args[0], args[1], itemsCount);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename, String fmtName, <span class="java-keyword">int</span> count) {
        items = CompressArchiveStructure.create();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchive.html">IOutCreateArchive</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; outArchive = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/ArchiveFormat.html">ArchiveFormat</a> archiveFormat = <a href="javadoc/net/sf/sevenzipjbinding/ArchiveFormat.html">ArchiveFormat</a>.valueOf(fmtName);
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchive(archiveFormat);

            <span class="java-comment">// Configure archive</span>
            <span class="java-keyword">if</span> (outArchive instanceof <a href="javadoc/net/sf/sevenzipjbinding/IOutFeatureSetLevel.html">IOutFeatureSetLevel</a>) {
                ((<a href="javadoc/net/sf/sevenzipjbinding/IOutFeatureSetLevel.html">IOutFeatureSetLevel</a>) outArchive).setLevel(5);
            }
            <span class="java-keyword">if</span> (outArchive instanceof <a href="javadoc/net/sf/sevenzipjbinding/IOutFeatureSetMultithreading.html">IOutFeatureSetMultithreading</a>) {
                ((<a href="javadoc/net/sf/sevenzipjbinding/IOutFeatureSetMultithreading.html">IOutFeatureSetMultithreading</a>) outArchive).setThreadCount(2);
            }

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    count, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"7z-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(archiveFormat.getMethodName() 
                    + <span class="java-string">" archive with "</span> + count + <span class="java-string">" item(s) created"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressGeneric.java">download java code</a></div>
<p>
Now you can run the snippet with different parameters creating archives with different formats. The last parameter
specifies, how many archive items from the <a href="#archive-test-structure">CompressArchiveStructure</a> should be
compressed. This number should be between 1 and 5 for 7z, Zip and Tar, and must be 1 for the stream formats GZip and BZip2.
</p>
<ul class="list-with-pre-s">
<li>To create a 7z archive with 5 items:
<div class="fragment"><pre class="fragment">
C:\Test&gt; java -cp ... CompressGeneric SEVEN_ZIP compressed_generic.zip 5
7z archive with 5 item(s) created
</pre></div>
</li>
<li>To create a Zip archive with 5 items:
<div class="fragment"><pre class="fragment">
C:\Test&gt; java -cp ... CompressGeneric ZIP       compressed_generic.zip 5
Zip archive with 5 item(s) created
</pre></div>
</li>
<li>To create a Tar archive with 5 items:
<div class="fragment"><pre class="fragment">
C:\Test&gt; java -cp ... CompressGeneric TAR       compressed_generic.tar 5
Tar archive with 5 item(s) created
</pre></div>
</li>
<li>To create a GZip archive with 1 item:
<div class="fragment"><pre class="fragment">
C:\Test&gt; java -cp ... CompressGeneric GZIP      compressed_generic.zip 1
GZip archive with 1 item(s) created
</pre></div>
</li>
<li>To create a BZip2 archive with 1 item:
<div class="fragment"><pre class="fragment">
C:\Test&gt; java -cp ... CompressGeneric BZIP2     compressed_generic.bz2 1
BZip2 archive with 1 item(s) created
</pre></div>
</li>
</ul>
<p>
Also a bunch of the compressed_generic.* archives should be created with the corresponding contents.
</p>
<br/>
<h1><a name="update">Modifying existing archives</h1>
<p>
7-Zip-JBinding provides API for archive modification. Especially by small changes the modification of an archive
is much faster compared to the extraction and the consequent compression.
The archive modification API (like the compression API) offers archive format specific
and archive format independent variants.
The process of the modification of an existing archive contains following steps: 
</p>
<ul>
<li>Open existing archive obtaining an instance of the <a href="javadoc/net/sf/sevenzipjbinding/IInArchive.html">IInArchive</a></li>
<li>Call <a href="javadoc/net/sf/sevenzipjbinding/IInArchive.html">IInArchive</a>.getConnectedOutArchive() to get an instance of the <a href="javadoc/net/sf/sevenzipjbinding/IOutUpdateArchive.html">IOutUpdateArchive</a></li>
<li>Optionally cast it to an archive format specific API interface like <a href="javadoc/net/sf/sevenzipjbinding/IOutUpdateArchiveZip.html">IOutUpdateArchiveZip</a></li>
<li>Call <a href="javadoc/net/sf/sevenzipjbinding/IOutUpdateArchive.html">IOutUpdateArchive</a>.updateItems() passing the new count of items and a callback implementing the modification</li>
</ul>
<p>
The following snippets show the modification process in details using archive format independent API.
The archive to be modified is one of the Zip, 7z or Tar archives created by the corresponding compression
snippets on this page. The structure of those archives is specified in the <a href="#archive-test-structure">CompressArchiveStructure</a> class.
</p>
<h2><a name="update-alter-items">Altering existing archive items</h2>
<p>
The first snippet modifies one existing item with index 2 (info.txt, 16 bytes):
</p>
<ul>
<li>It changes the path (name of the item) to the "info2.txt"</li>
<li>It changes the content to the "More Info!" (10 bytes)</li>
</ul>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.Closeable;
<span class="java-keyword">import</span> java.io.RandomAccessFile;
<span class="java-keyword">import</span> java.util.ArrayList;
<span class="java-keyword">import</span> java.util.List;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IInArchive.html">IInArchive</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IInStream.html">IInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutUpdateArchive.html">IOutUpdateArchive</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileInStream.html">RandomAccessFileInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> UpdateAlterItems {
<span class="java-javadoc">    /**
     * The callback defines the modification to be made.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; outItemFactory) 
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (index != 2) {
                <span class="java-comment">// Keep properties and content</span>
                <span class="java-keyword">return</span> outItemFactory.createOutItem(index);
            }

            <a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a> item;
            item = outItemFactory.createOutItemAndCloneProperties(index);

            <span class="java-comment">// Change property PATH</span>
            item.setUpdateIsNewProperties(<span class="java-keyword">true</span>);
            item.setPropertyPath(<span class="java-string">"info2.txt"</span>);

            <span class="java-comment">// Change content</span>
            item.setUpdateIsNewData(<span class="java-keyword">true</span>);
            item.setDataSize((<span class="java-keyword">long</span>) <span class="java-staticfield">NEW_CONTENT</span>.length);

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (i != 2) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-staticfield">NEW_CONTENT</span>, <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">static</span> <span class="java-keyword">final</span> <span class="java-keyword">byte</span>[] <span class="java-staticfield">NEW_CONTENT</span> = <span class="java-string">"More Info!"</span>.getBytes();

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 2) {
            <span class="java-keyword">new</span> UpdateAlterItems().compress(args[0], args[1]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java UpdateAlterItems &#60;in-arc&#62; &#60;out-arc&#62;"</span>);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String in, String out) {
        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile inRaf = <span class="java-keyword">null</span>;
        RandomAccessFile outRaf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IInArchive.html">IInArchive</a> inArchive;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutUpdateArchive.html">IOutUpdateArchive</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; outArchive = <span class="java-keyword">null</span>;
        List&#60;Closeable&#62; closeables = <span class="java-keyword">new</span> ArrayList&#60;Closeable&#62;();
        <span class="java-keyword">try</span> {
            <span class="java-comment">// Open input file</span>
            inRaf = <span class="java-keyword">new</span> RandomAccessFile(in, <span class="java-string">"r"</span>);
            closeables.add(inRaf);
            <a href="javadoc/net/sf/sevenzipjbinding/IInStream.html">IInStream</a> inStream = <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileInStream.html">RandomAccessFileInStream</a>(inRaf);

            <span class="java-comment">// Open in-archive</span>
            inArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.<span class="java-staticmethod">openInArchive</span>(<span class="java-keyword">null</span>, inStream);
            closeables.add(inArchive);

            outRaf = <span class="java-keyword">new</span> RandomAccessFile(out, <span class="java-string">"rw"</span>);
            closeables.add(outRaf);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = inArchive.getConnectedOutArchive();

            <span class="java-comment">// Modify archive</span>
            outArchive.updateItems(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(outRaf),
                    inArchive.getNumberOfItems(), <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"7z-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">for</span> (<span class="java-keyword">int</span> i = closeables.size() - 1; i &#62;= 0; i--) {
                <span class="java-keyword">try</span> {
                    closeables.get(i).close();
                } <span class="java-keyword">catch</span> (Throwable e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing resource: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Update successful"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/UpdateAlterItems.java">download java code</a></div>
<p>
If you run this program with (on Linux)
</p>
<div class="fragment"><pre class="fragment">
$ java -cp &lsaquo;path-to-lib&rsaquo;\sevenzipjbinding.jar;              \ 
           &lsaquo;path-to-lib&rsaquo;\sevenzipjbinding-Windows-x86.jar;. \ 
       UpdateAlterItems <git-root>/testdata/snippets/to-update.7z updated.7z
</pre></div>
<p>
you will get the output
</p>
<div class="fragment"><pre class="fragment">
Update successful
</pre></div>
<p>
Now lets look at original and modified archives:
</p>
<div class="fragment"><pre class="fragment">
$ 7z l <git-root>/testdata/snippets/to-update.7z
...
   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2015-09-14 07:57:09 .....           38          159  dir1/file1.txt
2015-09-14 07:57:09 .....           38               dir2/file2.txt
2015-09-14 07:57:09 .....           16               info.txt
2015-09-14 07:57:09 .....          100               random-100-bytes.dump
2015-09-14 07:57:09 D....            0            0  dir2/
------------------- ----- ------------ ------------  ------------------------
                                   192          159  4 files, 1 folders
</pre></div>
<div class="fragment"><pre class="fragment">
$ 7z l updated.7z
   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2015-09-14 07:57:09 .....           38          151  dir1/file1.txt
2015-09-14 07:57:09 .....           38               dir2/file2.txt
2015-09-14 07:57:09 .....          100               random-100-bytes.dump
2015-09-14 07:57:09 .....           10           16  info2.txt
2015-09-14 07:57:09 D....            0            0  dir2/
------------------- ----- ------------ ------------  ------------------------
                                   186          167  4 files, 1 folders
</pre></div>
<p>
As you can see, the file "info.txt" (16 bytes) was replaces with the file "info2.txt" (10 bytes).
</p>
<h2><a name="update-add-remove-items">Adding and removing archive items</h2>
<p>
Now lets see how archive items can be added and removed.
In order to remove an archive item a reindexing is necessary. In the previous snippet for each archive
item the indexes in the old archive and the index in the new archive were the same. But after removing one item all consequent
indexes in the new archive will change and will be less, that corresponding indexes in the old archive. Here is an example of removing
an item C with index 2:
</p>
<pre>
Index:          0      1      2      3      4
Old archive:   (A)    (B)    (C)    (D)    (E)
New archive:   (A)    (B)    (D)    (E)
</pre>
<p>
Here the index of D in the old archive is 3, but in the new archive is 2.
</p>
<p>
In order to add a new item the count of items in archive passed to the <a href="javadoc/net/sf/sevenzipjbinding/IOutArchive.html">IOutArchive</a>.updateItems() method should be increased.
In the callback the new item with the new index (that doesn't map to any old archive items) should be initialized exactly, like
new items get initialized during a compression operation. The next snippet
</p>
<ul>
<li>Removes "info.txt" file</li>
<li>Adds "data.dmp" file with 11 bytes of content</li>
</ul> 
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.Closeable;
<span class="java-keyword">import</span> java.io.RandomAccessFile;
<span class="java-keyword">import</span> java.util.ArrayList;
<span class="java-keyword">import</span> java.util.List;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IInArchive.html">IInArchive</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IInStream.html">IInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutUpdateArchive.html">IOutUpdateArchive</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/PropID.html">PropID</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileInStream.html">RandomAccessFileInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> UpdateAddRemoveItems {
<span class="java-javadoc">    /**
     * The callback defines the modification to be made.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; outItemFactory) 
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (index == <span class="java-field">itemToAdd</span>) {
                <span class="java-comment">// Adding new item</span>
                <a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a> outItem = outItemFactory.createOutItem();
                outItem.setPropertyPath(<span class="java-field">itemToAddPath</span>);
                outItem.setDataSize((<span class="java-keyword">long</span>) itemToAddContent.length);

                <span class="java-keyword">return</span> outItem;
            }

            <span class="java-comment">// Remove item by changing the mapping "new index"-&#62;<span class="java-string">"old index"</span></span>
            <span class="java-keyword">if</span> (index &#60; itemToRemove) {
                <span class="java-keyword">return</span> outItemFactory.createOutItem(index);
            }
            <span class="java-keyword">return</span> outItemFactory.createOutItem(index + 1);
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (i != itemToAdd) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-staticfield">itemToAddContent</span>, <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">int</span> <span class="java-field">itemToAdd</span>; <span class="java-comment">// New index of the item to add</span>
    String <span class="java-field">itemToAddPath</span>;
    <span class="java-keyword">byte</span>[] <span class="java-field">itemToAddContent</span>;

    <span class="java-keyword">int</span> <span class="java-field">itemToRemove</span>; <span class="java-comment">// Old index of the item to be removed</span>

    <span class="java-keyword">private</span> <span class="java-keyword">void</span> initUpdate(<a href="javadoc/net/sf/sevenzipjbinding/IInArchive.html">IInArchive</a> inArchive) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
        <span class="java-field">itemToAdd</span> = inArchive.getNumberOfItems() - 1;
        <span class="java-field">itemToAddPath</span> = <span class="java-string">"data.dmp"</span>;
        <span class="java-field">itemToAddContent</span> = <span class="java-string">"dmp-content"</span>.getBytes();

        <span class="java-field">itemToRemove</span> = -1;
        <span class="java-keyword">for</span> (<span class="java-keyword">int</span> i = 0; i &#60; inArchive.getNumberOfItems(); i++) {
            <span class="java-keyword">if</span> (inArchive.getProperty(i, <a href="javadoc/net/sf/sevenzipjbinding/PropID.html">PropID</a>.<span class="java-staticfield">PATH</span>).equals(<span class="java-string">"info.txt"</span>)) {
                <span class="java-field">itemToRemove</span> = i;
                <span class="java-keyword">break</span>;
            }
        }
        <span class="java-keyword">if</span> (<span class="java-field">itemToRemove</span> == -1) {
            <span class="java-keyword">throw</span> <span class="java-keyword">new</span> RuntimeException(<span class="java-string">"Item 'info.txt' not found"</span>);
        }
    }

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 2) {
            <span class="java-keyword">new</span> UpdateAddRemoveItems().compress(args[0], args[1]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java UpdateAddRemoveItems &#60;in&#62; &#60;out&#62;"</span>);
    }

    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String in, String out) {
        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile inRaf = <span class="java-keyword">null</span>;
        RandomAccessFile outRaf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IInArchive.html">IInArchive</a> inArchive;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutUpdateArchive.html">IOutUpdateArchive</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemAllFormats.html">IOutItemAllFormats</a>&#62; outArchive = <span class="java-keyword">null</span>;
        List&#60;Closeable&#62; closeables = <span class="java-keyword">new</span> ArrayList&#60;Closeable&#62;();
        <span class="java-keyword">try</span> {
            <span class="java-comment">// Open input file</span>
            inRaf = <span class="java-keyword">new</span> RandomAccessFile(in, <span class="java-string">"r"</span>);
            closeables.add(inRaf);
            <a href="javadoc/net/sf/sevenzipjbinding/IInStream.html">IInStream</a> inStream = <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileInStream.html">RandomAccessFileInStream</a>(inRaf);

            <span class="java-comment">// Open in-archive</span>
            inArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.<span class="java-staticmethod">openInArchive</span>(<span class="java-keyword">null</span>, inStream);
            closeables.add(inArchive);

            initUpdate(inArchive);

            outRaf = <span class="java-keyword">new</span> RandomAccessFile(out, <span class="java-string">"rw"</span>);
            closeables.add(outRaf);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = inArchive.getConnectedOutArchive();

            <span class="java-comment">// Modify archive</span>
            outArchive.updateItems(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(outRaf),
                    inArchive.getNumberOfItems(), <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"7z-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">for</span> (<span class="java-keyword">int</span> i = closeables.size() - 1; i &#62;= 0; i--) {
                <span class="java-keyword">try</span> {
                    closeables.get(i).close();
                } <span class="java-keyword">catch</span> (Throwable e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing resource: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Update successful"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/UpdateAddRemoveItems.java">download java code</a></div>
<p>
If you run this program with (on Linux)
</p>
<div class="fragment"><pre class="fragment">
$ java -cp &lsaquo;path-to-lib&rsaquo;\sevenzipjbinding.jar;              \ 
           &lsaquo;path-to-lib&rsaquo;\sevenzipjbinding-Windows-x86.jar;. \ 
       UpdateAddRemoveItems &lsaquo;git&rsaquo;/testdata/snippets/to-update.7z updated.7z
</pre></div>
<p>
you will get the output
</p>
<div class="fragment"><pre class="fragment">
Update successful
</pre></div>
<p>
Now lets look at original and modified archives:
</p>
<div class="fragment"><pre class="fragment">
$ 7z l <git-root>/testdata/snippets/to-update.7z
...
   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2015-09-14 07:57:09 .....           38          159  dir1/file1.txt
2015-09-14 07:57:09 .....           38               dir2/file2.txt
2015-09-14 07:57:09 .....           16               info.txt
2015-09-14 07:57:09 .....          100               random-100-bytes.dump
2015-09-14 07:57:09 D....            0            0  dir2/
------------------- ----- ------------ ------------  ------------------------
                                   192          159  4 files, 1 folders
</pre></div>
<div class="fragment"><pre class="fragment">
$ 7z l updated.7z
...
   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2015-09-14 07:57:09 .....           38          151  dir1/file1.txt
2015-09-14 07:57:09 .....           38               dir2/file2.txt
2015-09-14 07:57:09 .....          100               random-100-bytes.dump
2015-09-16 21:43:52 .....           11           16  data.dmp
2015-09-14 07:57:09 D....            0            0  dir2/
------------------- ----- ------------ ------------  ------------------------
                                   187          167  4 files, 1 folders
</pre></div>
<p>
As you can see, the file info.txt is gone and the file data.dmp (11 bytes) appears in the archive.
</p>
<h1><a name="trace">Troubleshoot problems using tracing</h1>
<p>
One of the weak sides of the 7-zip compression engine is a rather simple error reporting. If
some provided data doesn't satisfy the compressor it fails without any descriptive error message.
One way to get an clue is to use 7-Zip-JBinding tracing feature. Here is the code passing invalid
data size for the item 1 and though failing.
</p>
<div class="fragment"><pre class="fragment">
<span class="java-keyword">import</span> java.io.IOException;
<span class="java-keyword">import</span> java.io.RandomAccessFile;

<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveTar.html">IOutCreateArchiveTar</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.impl.<a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.junit.snippets.CompressArchiveStructure.Item;
<span class="java-keyword">import</span> net.sf.sevenzipjbinding.util.<a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>;

<span class="java-keyword">public</span> <span class="java-keyword">class</span> CompressWithError {
<span class="java-javadoc">    /**
     * The callback provides information about archive items.
     */</span>
    <span class="java-keyword">private</span> <span class="java-keyword">final</span> <span class="java-keyword">class</span> MyCreateCallback 
            <span class="java-keyword">implements</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateCallback.html">IOutCreateCallback</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a>&#62; {

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setOperationResult(boolean operationResultOk)
                <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track each operation result here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setTotal(<span class="java-keyword">long</span> total) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <span class="java-keyword">void</span> setCompleted(<span class="java-keyword">long</span> complete) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-comment">// Track operation progress here</span>
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a> getItemInformation(<span class="java-keyword">int</span> index,
                <a href="javadoc/net/sf/sevenzipjbinding/impl/OutItemFactory.html">OutItemFactory</a>&#60;<a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a>&#62; outItemFactory) {
            <a href="javadoc/net/sf/sevenzipjbinding/IOutItemTar.html">IOutItemTar</a> item = outItemFactory.createOutItem();

            <span class="java-keyword">if</span> (<span class="java-field">items</span>[index].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-comment">// Directory</span>
                item.setPropertyIsDir(<span class="java-keyword">true</span>);
            } <span class="java-keyword">else</span> {
                <span class="java-comment">// File</span>
                item.setDataSize((<span class="java-keyword">long</span>) <span class="java-field">items</span>[index].getContent().<span class="java-field">length</span>);
            }

            item.setPropertyPath(<span class="java-field">items</span>[index].getPath());

            <span class="java-keyword">if</span> (index == 1) {
                item.setDataSize(<span class="java-keyword">null</span>); <span class="java-comment">// Provide invalid data for item 1</span>
            }

            <span class="java-keyword">return</span> item;
        }

        <span class="java-keyword">public</span> <a href="javadoc/net/sf/sevenzipjbinding/ISequentialInStream.html">ISequentialInStream</a> getStream(<span class="java-keyword">int</span> i) <span class="java-keyword">throws</span> <a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> {
            <span class="java-keyword">if</span> (<span class="java-field">items</span>[i].getContent() == <span class="java-keyword">null</span>) {
                <span class="java-keyword">return</span> <span class="java-keyword">null</span>;
            }
            <span class="java-keyword">return</span> <span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/util/ByteArrayStream.html">ByteArrayStream</a>(<span class="java-field">items</span>[i].getContent(), <span class="java-keyword">true</span>);
        }
    }

    <span class="java-keyword">private</span> Item[] items;

    <span class="java-keyword">public</span> <span class="java-keyword">static</span> <span class="java-keyword">void</span> main(String[] args) {
        <span class="java-keyword">if</span> (args.<span class="java-field">length</span> == 1) {
            <span class="java-keyword">new</span> CompressWithError().compress(args[0]);
            <span class="java-keyword">return</span>;
        }
        System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Usage: java CompressNonGenericTar &#60;archive&#62;"</span>);
    }


    <span class="java-keyword">private</span> <span class="java-keyword">void</span> compress(String filename) {
        items = CompressArchiveStructure.create();

        boolean success = <span class="java-keyword">false</span>;
        RandomAccessFile raf = <span class="java-keyword">null</span>;
        <a href="javadoc/net/sf/sevenzipjbinding/IOutCreateArchiveTar.html">IOutCreateArchiveTar</a> outArchive = <span class="java-keyword">null</span>;
        <span class="java-keyword">try</span> {
            raf = <span class="java-keyword">new</span> RandomAccessFile(filename, <span class="java-string">"rw"</span>);

            <span class="java-comment">// Open out-archive object</span>
            outArchive = <a href="javadoc/net/sf/sevenzipjbinding/SevenZip.html">SevenZip</a>.openOutArchiveTar();

            <span class="java-comment">// Activate tracing</span>
            outArchive.setTrace(<span class="java-keyword">true</span>);

            <span class="java-comment">// Create archive</span>
            outArchive.createArchive(<span class="java-keyword">new</span> <a href="javadoc/net/sf/sevenzipjbinding/impl/RandomAccessFileOutStream.html">RandomAccessFileOutStream</a>(raf),
                    <span class="java-field">items</span>.<span class="java-field">length</span>, <span class="java-keyword">new</span> MyCreateCallback());

            success = <span class="java-keyword">true</span>;
        } <span class="java-keyword">catch</span> (<a href="javadoc/net/sf/sevenzipjbinding/SevenZipException.html">SevenZipException</a> e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Tar-Error occurs:"</span>);
            <span class="java-comment">// Get more information using extended method</span>
            e.printStackTraceExtended();
        } <span class="java-keyword">catch</span> (Exception e) {
            System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error occurs: "</span> + e);
        } <span class="java-keyword">finally</span> {
            <span class="java-keyword">if</span> (outArchive != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    outArchive.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing archive: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
            <span class="java-keyword">if</span> (raf != <span class="java-keyword">null</span>) {
                <span class="java-keyword">try</span> {
                    raf.close();
                } <span class="java-keyword">catch</span> (IOException e) {
                    System.<span class="java-staticfield">err</span>.println(<span class="java-string">"Error closing file: "</span> + e);
                    success = <span class="java-keyword">false</span>;
                }
            }
        }
        <span class="java-keyword">if</span> (success) {
            System.<span class="java-staticfield">out</span>.println(<span class="java-string">"Compression operation succeeded"</span>);
        }
    }
}
</pre></div>
<div class="snippet-info"><a href="snippets/CompressWithError.java">download java code</a></div>
<p>
If you run this program you will get the following error message printed to the System.err:
</p>
<div class="fragment"><pre class="fragment">
0x80070057 (Invalid argument). Error creating 'tar' archive with 5 items
</pre></div>
<p>
The error message provides no useful information for finding the bug. But since the snippet enables
tracing by calling <a href="javadoc/net/sf/sevenzipjbinding/IOutArchive.html">IOutArchive</a>.setTrace(true), the trace log get printed to the System.out.
</p>
<div class="fragment"><pre class="fragment">
Compressing 5 items
Get update info (new data: true) (new props: true) (old index: -1) (index: 0)
Get property 'propertyIsDir' (index: 0)
Get property 'propertyPosixAttributes' (index: 0)
Get property 'propertyLastModificationTime' (index: 0)
Get property 'propertyPath' (index: 0)
Get property 'propertyUser' (index: 0)
Get property 'propertyGroup' (index: 0)
Get property 'dataSize' (index: 0)
Get update info (new data: true) (new props: true) (old index: -1) (index: 1)
Get property 'propertyIsDir' (index: 1)
Get property 'propertyPosixAttributes' (index: 1)
Get property 'propertyLastModificationTime' (index: 1)
Get property 'propertyPath' (index: 1)
Get property 'propertyUser' (index: 1)
Get property 'propertyGroup' (index: 1)
Get property 'dataSize' (index: 1)
</pre></div>
<p>
As you see, the tracing stops just after 7-zip retrieved the size of the data for the item 1. This
suggests, that the value for the size of the data of the item 1 may cause the failure. In this
small example, like in most other cases, this will help to find the problem.
</p>
</td></tr>
</table></td></tr>
</table>
</center>
</body>
</html>
