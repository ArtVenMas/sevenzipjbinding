# http://www.airport1.de/blog/archives/456-cMake-and-Java-it-works!-How-to-build-Java-Projects-with-cMake.html
PROJECT(SevenZipjBindingJava Java)

SET(JAVA_SOURCE_DIR ${PROJECT_SOURCE_DIR}/src)
SET(SEVENZIP_JBINDING_JAR ${PROJECT_BINARY_DIR}/sevenzip-jbinding.jar)
SET(JAVA_BIN_DIR ${PROJECT_BINARY_DIR}/bin)
SET(JAVAC_ARGS_FILE ${PROJECT_BINARY_DIR}/javac-args.tmp)

SET_PROPERTY(GLOBAL PROPERTY SEVENZIP_JBINDING_JAR ${SEVENZIP_JBINDING_JAR}) 
SET_PROPERTY(GLOBAL PROPERTY JAVA_BIN_DIR ${JAVA_BIN_DIR}) 

FILE(MAKE_DIRECTORY ${JAVA_BIN_DIR})
FILE(GLOB_RECURSE JAVA_SOURCE_FILES RELATIVE ${JAVA_SOURCE_DIR} src/*.java)

FILE(WRITE ${JAVAC_ARGS_FILE} "-source 1.5 -target 1.5\n")
FILE(APPEND ${JAVAC_ARGS_FILE} "-d ${JAVA_BIN_DIR} -s ${JAVA_BIN_DIR}\n")
FOREACH(F ${JAVA_SOURCE_FILES})
    FILE(APPEND ${JAVAC_ARGS_FILE} "${F}\n")
ENDFOREACH(F)

SET(JAVA_SOURCE_FILES_FULL "")
FOREACH(F ${JAVA_SOURCE_FILES})
    LIST(APPEND ${JAVA_SOURCE_FILES_FULL} "JAVA_SOURCE_DIR/${F}")
ENDFOREACH(F)

ADD_CUSTOM_COMMAND(OUTPUT ${SEVENZIP_JBINDING_JAR}
    COMMAND ${JAVA_COMPILE} @${JAVAC_ARGS_FILE}
    COMMAND ${JAVA_ARCHIVE} cf ${SEVENZIP_JBINDING_JAR} -C ${JAVA_BIN_DIR} .
    DEPENDS ${JAVA_SOURCE_FILES_FULL}
    WORKING_DIRECTORY ${JAVA_SOURCE_DIR}
    COMMENT Compiling java
)

ADD_CUSTOM_TARGET(sevenzip-jbinding-jar ALL
                  DEPENDS ${SEVENZIP_JBINDING_JAR})
                    
#SET(JAVA_CLASS_FILES "")
#FOREACH(F ${JAVA_SOURCE_FILES})
#    STRING(REGEX REPLACE "(.*)\\.java" "\\1.class" TMP "${F}")
#    LIST(APPEND JAVA_CLASS_FILES "${JAVA_BIN_DIR}/${TMP}")
#    MESSAGE("${TMP}")
#ENDFOREACH(F)
